<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple Polylines</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjb8Xx90GcIB9x2nJYuA2MLphWQ4lMDcU&signed_in=true&libraries=geometry"></script>
    <script src="gmaps.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/maplabel/src/maplabel.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>

    
function initMap() {
/*
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 3,
    center: {lat: 0, lng: -180},
    mapTypeId: google.maps.MapTypeId.TERRAIN
  });

  

  
  
  
  polys = [];
  jQuery.get("https://dl.dropboxusercontent.com/u/4055172/site/states.xml", {}, function(data){
    jQuery(data).find("state").each(function() {
      var colour = this.getAttribute('colour');
      var points = this.getElementsByTagName("point");
      var pts = [];
      for (var i = 0; i < points.length; i++) {
        pts[i] = new google.maps.LatLng(parseFloat(points[i].getAttribute("lat")), parseFloat(points[i].getAttribute("lng")));
      }
      var poly = new google.maps.Polygon({
        paths: pts,
        strokeColor: '#000000',
        strokeOpacity: 1,
        fillColor: colour,
        fillOpacity: 0.35
      });
      polys.push(poly);
      poly.setMap(map);
    });
  });
  */
  
  
 /*
    var map;
    $(document).ready(function(){
      map = new GMaps({
        div: '#map',
        lat: 39.743296277167325,
        lng: -105.00517845153809
      });
      var paths = [[[[-118.35,32.828],[-118.409,32.819],[-118.473,32.839],[-118.529,32.936],[-118.59,33.011],[-118.557,33.033],[-118.507,32.96],[-118.383,32.849],[-118.35,32.828]]],[[[-119.438,33.217],[-119.482,33.215],[-119.544,33.225],[-119.575,33.278],[-119.525,33.282],[-119.479,33.275],[-119.442,33.232],[-119.438,33.217]]],[[[-118.348,33.386],[-118.297,33.312],[-118.37,33.321],[-118.446,33.317],[-118.469,33.357],[-118.492,33.413],[-118.507,33.427],[-118.559,33.432],[-118.563,33.437],[-118.569,33.464],[-118.555,33.477],[-118.392,33.415],[-118.348,33.386]]],[[[-120.044,33.919],[-120.114,33.905],[-120.167,33.918],[-120.252,34.014],[-120.072,34.027],[-119.994,33.985],[-119.984,33.973],[-120.044,33.919]]],[[[-120.307,34.025],[-120.36,34.022],[-120.442,34.033],[-120.413,34.056],[-120.368,34.073],[-120.353,34.061],[-120.307,34.025]]],[[[-119.882,34.08],[-119.679,34.028],[-119.569,34.053],[-119.549,34.028],[-119.562,34.007],[-119.81,33.968],[-119.886,33.995],[-119.892,34.032],[-119.918,34.068],[-119.882,34.08]]],[[[-124.228,42.001],[-123.956,42.001],[-123.692,42.001],[-123.428,42.001],[-123.165,42.001],[-122.901,42.001],[-122.637,42.001],[-122.374,42.001],[-122.11,42.001],[-121.846,42.001],[-121.583,42.001],[-121.319,42.001],[-121.055,42.001],[-120.792,42.001],[-120.528,42.001],[-120.264,42.001],[-120.001,42.001],[-120.001,41.813],[-120.001,41.626],[-120.001,41.438],[-120.001,41.251],[-120.001,41.063],[-120.001,40.875],[-120,40.688],[-120,40.5],[-120,40.313],[-120,40.125],[-120,39.938],[-120,39.75],[-120,39.563],[-120,39.375],[-120,39.188],[-120,39],[-119.766,38.837],[-119.532,38.673],[-119.297,38.51],[-119.063,38.346],[-118.829,38.183],[-118.595,38.019],[-118.36,37.856],[-118.126,37.692],[-117.943,37.555],[-117.76,37.417],[-117.576,37.279],[-117.393,37.141],[-117.21,37.003],[-117.026,36.866],[-116.843,36.728],[-116.66,36.59],[-116.406,36.392],[-116.152,36.194],[-115.898,35.995],[-115.644,35.797],[-115.39,35.599],[-115.136,35.401],[-114.882,35.203],[-114.611,34.991],[-114.611,34.907],[-114.557,34.795],[-114.398,34.59],[-114.379,34.541],[-114.377,34.54],[-114.371,34.488],[-114.308,34.433],[-114.159,34.355],[-114.125,34.317],[-114.125,34.314],[-114.126,34.287],[-114.164,34.253],[-114.329,34.142],[-114.418,34.051],[-114.509,33.904],[-114.495,33.785],[-114.499,33.686],[-114.522,33.608],[-114.556,33.536],[-114.603,33.47],[-114.651,33.431],[-114.702,33.418],[-114.719,33.331],[-114.704,33.17],[-114.648,33.072],[-114.551,33.037],[-114.491,32.984],[-114.469,32.912],[-114.478,32.842],[-114.516,32.773],[-114.582,32.735],[-114.721,32.724],[-114.721,32.724],[-114.725,32.715],[-114.839,32.705],[-115.125,32.683],[-115.411,32.662],[-115.698,32.64],[-115.984,32.619],[-116.27,32.598],[-116.556,32.576],[-116.842,32.555],[-117.128,32.533],[-117.13,32.54],[-117.137,32.649],[-117.184,32.688],[-117.243,32.664],[-117.271,32.806],[-117.256,32.873],[-117.263,32.939],[-117.319,33.1],[-117.467,33.295],[-117.789,33.538],[-117.952,33.62],[-118.081,33.722],[-118.162,33.751],[-118.264,33.759],[-118.294,33.712],[-118.41,33.744],[-118.393,33.858],[-118.506,34.017],[-118.599,34.035],[-118.832,34.024],[-119.144,34.112],[-119.236,34.164],[-119.268,34.257],[-119.414,34.339],[-119.606,34.418],[-119.713,34.4],[-119.853,34.412],[-120.053,34.469],[-120.17,34.476],[-120.396,34.46],[-120.481,34.472],[-120.56,34.544],[-120.645,34.58],[-120.627,34.669],[-120.638,34.749],[-120.625,34.812],[-120.663,34.949],[-120.634,35.076],[-120.659,35.122],[-120.707,35.158],[-120.857,35.21],[-120.885,35.275],[-120.86,35.365],[-120.9,35.425],[-121.023,35.481],[-121.138,35.607],[-121.284,35.676],[-121.344,35.792],[-121.434,35.864],[-121.465,35.927],[-121.664,36.154],[-121.877,36.331],[-121.91,36.433],[-121.919,36.572],[-121.835,36.657],[-121.79,36.732],[-121.795,36.801],[-121.807,36.851],[-121.881,36.939],[-122.164,36.991],[-122.395,37.208],[-122.408,37.373],[-122.499,37.543],[-122.5,37.653],[-122.514,37.772],[-122.446,37.798],[-122.384,37.789],[-122.39,37.741],[-122.37,37.656],[-122.298,37.592],[-122.229,37.564],[-122.166,37.502],[-122.119,37.483],[-122.071,37.478],[-122.097,37.518],[-122.124,37.544],[-122.158,37.626],[-122.222,37.732],[-122.296,37.79],[-122.333,37.897],[-122.365,37.921],[-122.385,37.961],[-122.314,38.007],[-122.217,38.041],[-122.087,38.05],[-121.717,38.034],[-121.638,38.061],[-121.573,38.052],[-121.525,38.056],[-121.626,38.084],[-121.682,38.075],[-121.749,38.08],[-121.881,38.075],[-121.934,38.087],[-121.993,38.12],[-122.032,38.124],[-122.154,38.066],[-122.208,38.073],[-122.337,38.136],[-122.393,38.145],[-122.484,38.109],[-122.495,37.954],[-122.467,37.838],[-122.521,37.826],[-122.584,37.874],[-122.681,37.902],[-122.76,37.946],[-122.873,38.026],[-122.932,38.055],[-122.999,37.989],[-123.001,38.019],[-122.968,38.097],[-122.978,38.227],[-122.877,38.123],[-122.908,38.197],[-122.987,38.277],[-123.046,38.305],[-123.121,38.449],[-123.29,38.536],[-123.425,38.676],[-123.701,38.907],[-123.72,39.111],[-123.82,39.368],[-123.778,39.515],[-123.783,39.619],[-123.833,39.776],[-123.884,39.861],[-124.109,40.095],[-124.324,40.252],[-124.357,40.371],[-124.372,40.491],[-124.325,40.598],[-124.284,40.711],[-124.254,40.74],[-124.242,40.728],[-124.251,40.704],[-124.22,40.696],[-124.208,40.746],[-124.19,40.772],[-124.222,40.775],[-124.219,40.791],[-124.2,40.822],[-124.133,40.97],[-124.14,41.156],[-124.069,41.384],[-124.072,41.46],[-124.118,41.622],[-124.163,41.719],[-124.245,41.788],[-124.209,41.889],[-124.212,41.985],[-124.228,42.001]]]]; 
      polygon = map.drawPolygon({
        paths: paths,
        useGeoJSON: true,
        strokeColor: '#BBD8E9',
        strokeOpacity: 1,
        strokeWeight: 3,
        fillColor: '#BBD8E9',
        fillOpacity: 0.6
      });
    });  

*/

        var map = new google.maps.Map(document.getElementById('map'), {
          center: new google.maps.LatLng(37.4, -122.1),
          zoom: 10,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var layer = new google.maps.FusionTablesLayer({
          query: {
            select: 'kml_4326',
            from: '1sJ05KGmXEd5HD3HVoK66lSotJ6ad-KbUh6ae3Tmq',
          },
          styles: [{
                  polygonOptions: {
                    fillColor: "#000000",
                    fillOpacity: 0.1,
                  }
          }],
          map: map
        });

     
     //draw road map
     var decodedPath = google.maps.geometry.encoding.decodePath("aunwFflubM{yJbul@asPpo`@ciHjsTrzBb_]otFjek@cnCzmh@oeJhhb@yxJf_Zgb@bv\\lvBdmt@z~FxtaAufClj^tjExh`@tbAjdh@{rJjoZ{}@hbd@hfBxqo@b_Ahh]v{Lfu`@tCxhYecFtcNql@|vRbwFx{SygDtu\\gdGtcc@klHjeScwIr}l@uoD`ns@sMlmr@gaBrk_AyqAt}`AjmB|ndBtpF|go@vjD|rX}wL|~PegIhjJaIha\\ucA|_q@uxIxocA_vLnup@jwE|_`AkVzg~AopQzeqA{t[rwkAoE`qfBcfFht{BuiV`{j@yc@lkwB`iFv{iBosEvzn@j}Jrgg@~sRvnr@xKxtx@ht@bviApuErecAbnQpjjAjxLne\\bP`ap@hm@vaaAq`DjguAs}ClszByaC~s`@wvLr{D{~Oj{P}dF|y_BqiIvauDew@lqhDwTbf|A~mH`lhAyEvc\\|dHx~GpjK~yi@`_Hj|xAiQrczElv]`l\\lhTfhYv|@dxW~oCblS`tNpaVlpSbeQf~Tpsk@znKlfg@teBlgq@cEnazEkF||v@v`Rfos@zaIjqlBicEdepAg{h@|ueBaq_@tfyAalHhe{@tnB|f~@uUnxkAnpI~|z@xiZt}fArhSxizAvb^fi~@duz@`hy@hoPhzq@rdAfhc@tyO~{_BnmQl}s@nc^h}_@veWbgo@trP|`c@s}Elmc@mtAlwVwk@n{R`eK|xPjeD~sk@nqRbxZrzKfbJcvPbeN}wHniZne@~n]kbLdya@b`Inqe@loPjb|@op@pan@dvH|nz@xvLzos@~aVbb[jsWfrK|eOhkKk\\b{eAkqPdrt@|_Qxdg@n`[zoa@h`G~kf@jZv|}AegFrpWr|Hrai@ab@zlVv{LhfbAzjDbtw@rbMffo@{wDjjX}cQlzL_oD~qYfo@`{d@x{`@frj@vgPxgQrcKlkTpqBdwQqeH~`OvrGr~QtuZhsGlwj@mSfuIcuDtam@lu^fyi@npy@fh[~}Vj|a@|qJf~V~vR|v]hcj@vtPvdGriC`vQbjEpkSpxGxzR~zVhmz@`oLdxq@xkVr}^bky@bngA|oRd_Vh{U|dFpdXvp@dz\\fyYpkp@fcRndKpfLp}Kdzy@fiVnnp@rxQjuU~iRzdb@hlc@xmkBneB|z]meFfj\\}hPtpqAc{Cht{A{`Oh}StMxc^kpRdib@umKhn`@auQzw}@u`]ph[ena@xsGu|r@|mJwg~@dwPce]tpS{ue@a~DwhVyzA_eAc{C");  
     var roadPath = new google.maps.Polyline({
        path: decodedPath,
        geodesic: true,
        strokeColor: '#FF0000',
        strokeOpacity: 1.0,
        strokeWeight: 2
      });
     roadPath.setMap(map);

      var mapLabel = new MapLabel({
            text: 'Test',
            position: new google.maps.LatLng(34.515233, -100.918565),
            map: map,
            fontSize: 12,
            align: 'right'
        });
        
        
    $.ajax({
        url: "https://www.googleapis.com/fusiontables/v2/query",
        type: "POST",
        data: {
            sql: "Select center, temperature From 1sJ05KGmXEd5HD3HVoK66lSotJ6ad-KbUh6ae3Tmq",
            key: "AIzaSyCjb8Xx90GcIB9x2nJYuA2MLphWQ4lMDcU"
        },
        success: function (data) {
        console.log(data)
        for (i = 0; i < data.rows.length; i++) {
            latlong=data.rows[i][0].split(',')
            console.log(data.rows[i][1], latlong[0], latlong[1])
            new MapLabel({
                text: data.rows[i][1],
                position: new google.maps.LatLng(parseFloat(latlong[0]),parseFloat(latlong[1])*-1),
                map: map,
                fontSize: 12,
                align: 'right'
            });
        }
        }
    });

}

jQuery(document).ready(function () {
    initMap(); //run the map
});

    </script>
  </body>
</html>